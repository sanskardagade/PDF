/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{687:function(wa,ua,b){b.r(ua);var la=b(0),na=b(7),oa=b(2);wa=b(49);var ja=b(39),ia=b(21);b=function(){function ca(){this.init()}ca.prototype.init=function(){this.eza=!1;this.Th=this.Aq=this.connection=null;this.Wk={};this.ga=this.yS=null};ca.prototype.lD=function(x){for(var y=this,n=0;n<x.length;++n){var h=x[n];switch(h.at){case "create":this.Wk[h.author]||(this.Wk[h.author]=h.aName);this.uMa(h);break;case "modify":this.ga.ru(h.xfdf).then(function(f){y.ga.Jb(f[0])});
break;case "delete":h="<delete><id>".concat(h.aId,"</id></delete>"),this.ga.ru(h)}}};ca.prototype.uMa=function(x){var y=this;this.ga.ru(x.xfdf).then(function(n){n=n[0];n.authorId=x.author;y.ga.Jb(n);y.ga.trigger(na.d.UPDATE_ANNOTATION_PERMISSION,[n])})};ca.prototype.gLa=function(x,y,n){this.Aq&&this.Aq(x,y,n)};ca.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.gLa.bind(this,x,"add",{imported:!1}),{once:!0})};ca.prototype.initiateCollaboration=
function(x,y,n){var h=this;if(x){h.Th=y;h.ga=n.ka();n.addEventListener(na.i.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.H2a(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var r=JSON.parse(f.responseText);h.connection=exports.da.m4a(Object(ja.l)(h.Th,"blackbox/"),"annot");h.yS=r.id;h.Wk[r.id]=r.user_name;h.ga.c3(r.id);h.connection.w8a(function(e){e.t&&e.t.startsWith("a_")&&e.data&&h.lD(e.data)},function(){h.connection.send({t:"a_retrieve",
dId:x});h.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.Wk[r.id],h.yS])},function(){h.disableCollaboration()})}catch(e){Object(oa.g)(e.message)}});f.open("GET",Object(ja.l)(this.Th,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();h.eza=!0;h.ga.$ka(function(r){return h.Wk[r.Author]||r.Author})}else Object(oa.g)("Document ID required for collaboration")};ca.prototype.disableCollaboration=function(){this.Aq&&(this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Aq),this.Aq=
null);this.connection&&this.connection.Jw();this.ga&&this.ga.c3("Guest");this.init();this.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ca.prototype.H2a=function(x){var y=this;this.Aq&&this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Aq);this.Aq=function(n,h,f){return Object(la.c)(this,void 0,void 0,function(){var r,e,a,w,aa,z,fa,ea,ha;return Object(la.e)(this,function(ba){switch(ba.label){case 0:if(f.imported)return[2];r={t:"a_".concat(h),dId:x,annots:[]};return[4,y.ga.Fba()];
case 1:e=ba.aa();"delete"!==h&&(a=(new DOMParser).parseFromString(e,"text/xml"),w=new XMLSerializer);for(aa=0;aa<n.length;aa++)z=n[aa],ea=fa=void 0,"add"===h?(fa=a.querySelector('[name="'.concat(z.Id,'"]')),ea=w.serializeToString(fa),ha=null,z.InReplyTo&&(ha=y.ga.Jf(z.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:z.Id,author:y.yS,aName:y.Wk[y.yS],parent:ha,xfdf:"<add>".concat(ea,"</add>")})):"modify"===h?(fa=a.querySelector('[name="'.concat(z.Id,'"]')),ea=w.serializeToString(fa),
r.annots.push({at:"modify",aId:z.Id,xfdf:"<modify>".concat(ea,"</modify>")})):"delete"===h&&r.annots.push({at:"delete",aId:z.Id});0<r.annots.length&&y.connection.send(r);return[2]}})})}.bind(y);this.ga.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Aq)};ca.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ca}();Object(wa.b)(b);ua["default"]=b}}]);}).call(this || window)
